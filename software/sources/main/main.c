// /*
//  * Copyright:
//  * ----------------------------------------------------------------
//  * This confidential and proprietary software may be used only as
//  * authorised by a licensing agreement from ARM Limited
//  *   (C) COPYRIGHT 2014, 2016 ARM Limited
//  *       ALL RIGHTS RESERVED
//  * The entire notice above must be reproduced on all authorised
//  * copies and copies may only be made to the extent permitted
//  * by a licensing agreement from ARM Limited.
//  * ----------------------------------------------------------------
//  * File:     main.c
//  * Release Information : Cortex-M3 DesignStart-r0p0-00rel0
//  * ----------------------------------------------------------------
//  *
//  */

// /*
//  * --------Included Headers--------
//  */

// #include "OV5640.h"
// #include "sys.h"
// // Xilinx specific headers

// static XGpio gpio; 
// static XGpio iicgpio;

// /*******************************************************************/


// int main (void)
// {
// 	u32 *BufferPtr = (u32 *)0x80000100;
	
// 	XGpio_Initialize(&gpio, XPAR_LED_GPIO_DEVICE_ID);
// 	XGpio_Initialize(&iicgpio, XPAR_CAM_GPIO_DEVICE_ID);

// 	XGpio_SetDataDirection(&gpio, 1, 0xFFFFFFF0);
// 	XGpio_DiscreteWrite(&gpio, 1, 0x1);
// 	XGpio_DiscreteWrite(&gpio, 1, 0x0);
// 	// XGpio_SetDataDirection(&iicgpio, 1, 0x0);
// 	// XGpio_SetDataDirection(&iicgpio, 2, 0x0);
	
// 	// XGpio_DiscreteWrite(&iicgpio, 1, 0x1);
// 	// XGpio_DiscreteWrite(&iicgpio, 2, 0x1);

//   // Main loop.  Handle LEDs and switches via interrupt
//   while ( 1 )
//   {

//    }
// }
#include "memalloc.h"

#include "xparameters.h"
//#include "OV5640.h"
#include "sys.h"
#include "DMA.h"
#include "OV5640_1.h"
#include "lcd.h"
#include "xaxivdma.h"
#include "xaxivdma_i.h"
/********************************************/
/***************by xuzhenyu******************/
/*******************************************/
#include "image.h"
#include <stdlib.h>

#define MAX_WIDTH 320
#define MAX_HEIGHT 240
#define MAX_LEN    MAX_WIDTH*MAX_HEIGHT

#define POINT_COLOR BLACK
#define BACK_COLCR WHITE

static XUartLite UART0_instance;

#define MEM_BASE_ADDR		0x80000000
#define BYTES_PER_PIXEL 4
#define MAX_PKT_LEN		(MAX_WIDTH * MAX_HEIGHT * BYTES_PER_PIXEL)
XGpio BTN;
XGpio ACC;
XGpio RST;
int flag = 0;
char char_result = 0;
u8 recognise = 0;
u8 adjust = 0;
u8 ready =0;
u8 clear = 0;
u32 img_test4[784]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,56,0,0,0,0,0,0,0,18,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,58,0,0,0,0,0,0,0,37,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,49,58,0,0,0,0,0,0,0,24,53,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,63,34,0,0,0,0,0,0,0,29,63,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,59,54,3,0,0,0,0,0,0,0,48,63,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,62,13,0,0,0,0,0,0,0,5,64,63,5,0,0,0,0,0,0,0,0,0,0,0,0,0,21,61,53,0,0,0,0,0,0,0,0,35,63,47,1,0,0,0,0,0,0,0,0,0,0,0,0,0,42,63,27,0,0,0,0,0,0,0,8,58,63,17,0,0,0,0,0,0,0,0,0,0,0,0,0,4,56,63,0,0,0,0,0,0,0,0,34,63,53,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,63,41,0,0,0,0,0,0,0,0,42,63,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,51,52,5,0,0,0,0,0,0,6,63,63,27,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,63,50,21,21,21,21,32,41,49,63,63,27,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,43,61,63,63,63,63,58,58,63,63,63,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,21,21,21,21,0,0,40,63,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,63,63,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,63,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,63,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,63,61,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,58,59,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
u32 img_test7[784]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,84,185,159,151,60,36,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,222,254,254,254,254,241,198,198,198,198,198,198,198,198,170,52,0,0,0,0,0,0,0,0,0,0,0,0,67,114,72,114,163,227,254,225,254,254,254,250,229,254,254,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,66,14,67,67,67,59,21,236,254,106,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,83,253,209,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,22,233,255,83,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,254,238,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,59,249,254,62,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,133,254,187,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,205,248,58,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,254,182,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,75,251,240,57,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,221,254,166,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,203,254,219,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,254,254,77,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,224,254,115,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,133,254,254,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61,242,254,254,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,121,254,254,219,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,121,254,207,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
u32 img_test2[784]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,116,125,171,255,255,150,93,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,169,253,253,253,253,253,253,218,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,169,253,253,253,213,142,176,253,253,122,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,52,250,253,210,32,12,0,6,206,253,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,77,251,210,25,0,0,0,122,248,253,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,18,0,0,0,0,209,253,253,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,117,247,253,198,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,76,247,253,231,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,253,253,144,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,176,246,253,159,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,234,253,233,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,198,253,253,141,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,78,248,253,189,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,200,253,253,141,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,134,253,253,173,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,248,253,253,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,248,253,253,43,20,20,20,20,5,0,5,20,20,37,150,150,150,147,10,0,0,0,0,0,0,0,0,0,248,253,253,253,253,253,253,253,168,143,166,253,253,253,253,253,253,253,123,0,0,0,0,0,0,0,0,0,174,253,253,253,253,253,253,253,253,253,253,253,249,247,247,169,117,117,57,0,0,0,0,0,0,0,0,0,0,118,123,123,123,166,253,253,253,155,123,123,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
u32 img_test1[784]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,254,109,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,87,252,82,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135,241,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,244,150,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,84,254,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,202,223,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,254,216,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,254,195,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,140,254,77,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,57,237,205,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,124,255,165,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,171,254,81,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,232,215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,254,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,151,254,142,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,228,254,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61,251,254,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,141,254,205,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,215,254,121,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,198,176,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
u32 img_test0[784]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,150,253,202,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,37,251,251,253,107,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,197,251,251,253,107,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,110,190,251,251,251,253,169,109,62,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,251,251,251,251,253,251,251,220,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,182,255,253,253,253,253,234,222,253,253,253,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,221,253,251,251,251,147,77,62,128,251,251,105,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,231,251,253,251,220,137,10,0,0,31,230,251,243,113,5,0,0,0,0,0,0,0,0,0,0,0,0,37,251,251,253,188,20,0,0,0,0,0,109,251,253,251,35,0,0,0,0,0,0,0,0,0,0,0,0,37,251,251,201,30,0,0,0,0,0,0,31,200,253,251,35,0,0,0,0,0,0,0,0,0,0,0,0,37,253,253,0,0,0,0,0,0,0,0,32,202,255,253,164,0,0,0,0,0,0,0,0,0,0,0,0,140,251,251,0,0,0,0,0,0,0,0,109,251,253,251,35,0,0,0,0,0,0,0,0,0,0,0,0,217,251,251,0,0,0,0,0,0,21,63,231,251,253,230,30,0,0,0,0,0,0,0,0,0,0,0,0,217,251,251,0,0,0,0,0,0,144,251,251,251,221,61,0,0,0,0,0,0,0,0,0,0,0,0,0,217,251,251,0,0,0,0,0,182,221,251,251,251,180,0,0,0,0,0,0,0,0,0,0,0,0,0,0,218,253,253,73,73,228,253,253,255,253,253,253,253,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,113,251,251,253,251,251,251,251,253,251,251,251,147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,230,251,253,251,251,251,251,253,230,189,35,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,142,253,251,251,251,251,253,107,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,72,174,251,173,71,72,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
u32 img_test5[784]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,47,47,47,16,129,85,47,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,75,153,217,253,253,253,215,246,253,253,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,142,244,252,253,253,253,253,253,253,253,253,253,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,253,253,253,253,253,253,253,213,170,170,170,170,0,0,0,0,0,0,0,0,0,0,0,20,132,72,0,57,238,227,238,168,124,69,20,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,206,253,78,0,0,32,0,30,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,177,253,132,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,133,253,233,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,92,253,223,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,150,253,174,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,234,253,246,127,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,253,253,253,251,147,91,121,85,42,42,85,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,139,253,253,253,253,253,253,253,253,253,253,253,232,168,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,53,218,222,251,253,253,253,253,253,253,253,253,252,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,67,72,200,253,253,253,253,253,253,253,175,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,253,249,152,51,164,253,253,175,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,50,253,253,253,188,252,253,253,148,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,167,253,253,253,253,250,175,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,23,180,231,253,221,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,93,149,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
u32* img_test[6]={img_test4,img_test2,img_test4,img_test2,img_test4};
/*
u32 img_patten3[]={0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
u32 img_patten5[]={0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
u32 img_patten2[]={0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
*/

u8 carID[5]={0};

u8 carID0[6]={0};
u8 carID1[6]={0};
u8 carID2[6]={0};
u8 carID3[6]={0};
u8 carID4[6]={0};
u8 carID5[6]={0};
u8 carID6[6]={0};
u8 carID7[6]={0};
u8 carID8[6]={0};
u8 carID9[6]={0};
u8 carID10[6]={0};
u8 carID11[6]={0};
u8 carID12[6]={0};
u8 carID13[6]={0};
u8 carID14[6]={0};
u8 carID15[6]={0};
u8 carID16[6]={0};
u8 carID17[6]={0};
u8 carID18[6]={0};
u8 carID19[6]={0};

u8* result[20]={carID0,carID1,carID2,carID3,carID4,carID5,carID6,carID7,carID8,carID9,carID10,carID11,carID12,carID13,carID14,carID15,carID16,carID17,carID18,carID19};


u8 carIDSTR[6]={0};
u8 num=0;
u8 finish = 0;

u32 regmask = 0x01;
u32 upmask = 0x01<<1;
u32 downmask = 0x01<<4;
u32 leftmask = 0x01<<2;
u32 rightmask = 0x01<<3;

/*
u32 x = 154;
u32 y = 30;
u32 width = 140;
u32 hight = 52;


u32 x_pre = 154;
u32 y_pre = 30;
u32 width_pre = 140;
u32 hight_pre = 52;
*/

u32 x = 166;
u32 y = 37;
u32 width = 112;
u32 hight = 54;


u32 x_pre = 166;
u32 y_pre = 37;
u32 width_pre = 112;
u32 hight_pre = 54;


u32 step = 2;

u32 m=0;
int main()

{
	//u32 * ptr = (u32*)MEM_BASE_ADDR;
		int Status;
		XAxiVdma InstancePtr;
	  //init_platform();
		XUartLite_Initialize(&UART0_instance, XPAR_UARTLITE_DEVICE_ID);
		print("application start...\n");
		XGpio_Initialize(&LED, XPAR_LED_GPIO_DEVICE_ID);
		XGpio_SetDataDirection(&LED, 1, 0);
		XGpio_DiscreteWrite(&LED, 1, 0x0);
		//XGpio_DiscreteWrite(&LED, 1, 0xf);
	
		XGpio_Initialize(&ACC,XPAR_ACC_CTRL_DEVICE_ID);
		XGpio_SetDataDirection(&ACC, 1, 0);
		XGpio_Initialize(&RST,XPAR_RST_CTRL_DEVICE_ID);
		XGpio_SetDataDirection(&RST, 1, 0);
		
		
/*	while(1){
		XGpio_DiscreteWrite(&LED, 1, 0x1);
		print("Error - Xilinx GPIO failed to initialise\n");
		delayms(2500);
		XGpio_DiscreteWrite(&LED, 1, 0x0);
		delayms(2500);
	}
	*/
		XGpio_Initialize(&BTN, XPAR_BTN_DEVICE_ID);
		SNVIC_ClearAllPendingIRQ();
		SNVIC_EnableIRQ(0);
		SNVIC_EnableIRQ(3);
		SNVIC_EnableIRQ(4);
		SNVIC_EnableIRQ(5);
		SNVIC_EnableIRQ(6);
		SNVIC_EnableIRQ(7);
		SNVIC_EnableIRQ(8);
		SNVIC_EnableIRQ(9);
		SNVIC_EnableIRQ(10);
		SNVIC_EnableIRQ(11);
		SNVIC_EnableIRQ(12);
		XGpio_SetDataDirection(&BTN,1,0xf);
		XGpio_InterruptEnable(&BTN,0x01);
		XGpio_InterruptGlobalEnable(&BTN);
		
		LCD_init();	
		//LCD_Clear(YELLOW); 
	//	LCD_DrawLine(0,0,320,240);
		//LCD_Clear(BACK_COLCR);
		pool_init();
		
	  	print("lcd initializing\n");
			Status = XGpio_Initialize(&IIC, XPAR_CAM_GPIO_DEVICE_ID);
			if (Status != XST_SUCCESS) {
				return XST_FAILURE;
			}
			 delayms(200);
		    SIO_D_OUT;
		    SIO_C_OUT;
			
		    //OV5640_init();
			print("ov5640 init start\n");
			ov5640_init_rgb();
			OV5640_OutSize_Set(4,0,320,240);
			print("ov5640 init end\n");

			// by xuzhenyu
			EbRGBImg* src = (EbRGBImg*)malloc(sizeof(EbRGBImg*));
			EbGrayImg*  plate_img = (EbGrayImg*)malloc(sizeof(EbGrayImg*));
			EbGrayImg*  temp1 = (EbHSVImg* )malloc(sizeof(EbGrayImg*));
			EbGrayImg*  temp2 = (EbHSVImg* )malloc(sizeof(EbGrayImg*));
			EbGrayImg*  temp3 = (EbHSVImg* )malloc(sizeof(EbGrayImg*));
			
			EbGrayImg*  test = (EbGrayImg* )malloc(sizeof(EbGrayImg*));
			test->imageData = (u32 *)malloc(sizeof(u32)*MAX_LEN);
			test->imageData = (u32*)img_test4;
			test->height = 28;
			test->width = 28;
			
			src->imageData = (u32 *)malloc(sizeof(u32)*MAX_LEN);
			plate_img->imageData = (u32 *)malloc(sizeof(u32)*MAX_LEN);
			temp1->imageData = (u32 *)malloc(sizeof(u32)*MAX_LEN);			
			temp2->imageData = (u32 *)malloc(sizeof(u32)*MAX_LEN);			
			temp3->imageData = (u32 *)malloc(sizeof(u32)*MAX_LEN);
			cSize input_size = createSize(320, 240);	
			
			byte* mark = (byte*) malloc(sizeof(byte)*MAX_LEN);
			
			for(m=0;m<MAX_LEN;m++){
				mark[m] = 0;
			}
			
			
			EbGrayImg* char_img [5];
			for (int i = 0;i <5;i++){
			char_img[i]  = (EbGrayImg*)malloc(sizeof(EbGrayImg*));
			char_img[i]->imageData = (u32*)malloc(sizeof(u32)*784);
			}
			delayms(5000);
			run_triple_frame_buffer(&InstancePtr, 0, 320, 240,
							MEM_BASE_ADDR, 2, 0);
	/*		while(1){
				LCD_Clear(BACK_COLCR);
				DMA_Trans((u32)MEM_BASE_ADDR,MAX_PKT_LEN, DEVICE_TO_DMA);
				loadRGB((u32 *)MEM_BASE_ADDR,input_size, src);
				show_pic(src);
				delayms(1000);
			}*/
	while(1){
	char state1=0,state2=0,state3=0;
	/***************************************************************/
	/**********condition1: camera location specify state************/
	/***************************************************************/
			/*			while(1){
							state1 = 1;
							DMA_Trans((u32)MEM_BASE_ADDR,MAX_PKT_LEN, DEVICE_TO_DMA);

								cSize input_size = createSize(320, 240);							
								loadRGB((u32 *)MEM_BASE_ADDR,input_size, src);
								show_pic(src);
								//clear_pic(src);
								extraction(src, plate_img,temp1);
								//
								show_pic(temp1);
								//clear_pic(temp1);
								delayms(1000);
							
					} *///end of condition1
/*******************************************************************/
/****************condition2: recoginization state*******************/
/*******************************************************************/
					/*	VIN_RST_HIGH;
						delayus(10);
						VIN_RST_LOW;
						delayus(10);
						VIN_RST_HIGH;
					  DMA_Trans((u32)MEM_BASE_ADDR,MAX_PKT_LEN, DEVICE_TO_DMA);
					  loadRGB((u32 *)MEM_BASE_ADDR,input_size, src);
						delayms(100);
						
						VIN_RST_HIGH;
						delayus(10);
						VIN_RST_LOW;
						delayus(10);
						VIN_RST_HIGH;
					  DMA_Trans((u32)MEM_BASE_ADDR,MAX_PKT_LEN, DEVICE_TO_DMA);
						*/
						cRect origin_size = createRect(x,y,width,hight);
					  loadRGB((u32 *)MEM_BASE_ADDR,input_size, src,origin_size,0);
						delayms(100);
						
						//show_pic(src);
						


			while(1){
							int result_array [5] = {0,0,0,0,0}; 
							int count = 0;
							u8 i = 0;
							u8 j = 0;
							/*DMA_Trans((u32)MEM_BASE_ADDR,MAX_PKT_LEN, DEVICE_TO_DMA);
								cSize input_size = createSize(320, 240);	
								loadRGB((u32 *)MEM_BASE_ADDR,input_size, src);
								extraction(src, plate_img,temp1);
								segment(temp1,char_img,temp2,temp3);
								show_pic(test);
							*/
								//u32*arr = test->imageData;

							
							while(0==recognise){
							
								loadRGB((u32 *)MEM_BASE_ADDR,input_size, src,origin_size,0);
								show_pic(src);
								print("flush");
							}

							while(1==recognise){
								
									//LCD_DrawRectangle(x_pre,y_pre,x_pre+width_pre,y_pre+hight_pre,BACK_COLCR);
								if(1==clear){
									LCD_DrawRectangle(x_pre,y_pre,x_pre+width_pre,y_pre+hight_pre,BACK_COLCR);
									clear = 0;
								}
								else{
									LCD_DrawRectangle(x,y,x+width,y+hight,WHITE);
								}
							}
								while(2==recognise){
									cRect cut_area = createRect(x,y,width,hight);
									u8 n=0;
									u8 m=0;
								  print("start\n");
									XGpio_DiscreteWrite(&LED, 1, 0xf);
									for (n=0;n<20;n++){
										loadRGB((u32 *)MEM_BASE_ADDR,input_size, src, cut_area,1);
										print("DOWN\n");
										//extraction(src, plate_img,temp1);
										segment(src,char_img,temp2,temp3);
										//show_pic(src);
										//delayms(100);
										debug("n: %d\n",n);
									  for(i=0;i<5;i++){
											//LCD_DrawPic(30*i,src->height,char_img[i]);
										  carID[i] = (u8)get_result(char_img[i]);
										  debug("%d\n",carID[i]);
											result[n][i] = carID[i]+'0';
											//print("model\n");
											//debug_Pic(char_img[i]);
											//print("modelend\n");
									  }

									//delayms(10);
									//LCD_DrawString(0,170,"the result is:",20,WHITE,BLACK);
									//LCD_DrawString(0,200,carIDSTR,24,WHITE,BLACK);
									//print("ends\n");
									//while(1);

									}
									XGpio_DiscreteWrite(&LED, 1, 0x0);
									//recognise=2;
									LCD_Clear(BLACK);
									for(m=0;m<10;m++){
										LCD_DrawString(0,24*m,result[m],16,WHITE,BLACK); 
									}
									for(m=0;m<10;m++){
										LCD_DrawString(160,24*m,result[m+10],16,WHITE,BLACK);
									}
									
									while(1);
																		
								/*	VIN_RST_HIGH;
									delayus(10);
									VIN_RST_LOW;
									delayus(10);
									VIN_RST_HIGH;
									DMA_Trans((u32)MEM_BASE_ADDR,MAX_PKT_LEN, DEVICE_TO_DMA);
									loadRGB((u32 *)MEM_BASE_ADDR,input_size, src);
									delayms(100);
									
									VIN_RST_HIGH;
									delayus(10);
									VIN_RST_LOW;					
									delayus(10);
									VIN_RST_HIGH;
									DMA_Trans((u32)MEM_BASE_ADDR,MAX_PKT_LEN, DEVICE_TO_DMA);
									
									
									*/
							
							/*		loadRGB((u32 *)MEM_BASE_ADDR,input_size, src, origin_size, 0);
									
									
									//loadRGB((u32 *)MEM_BASE_ADDR,input_size, src);
									extraction(src, plate_img,temp1);
									//thining(temp1,mark);
									segment(temp1,char_img,temp2,temp3);
									show_pic(temp1);
									print("process finished\n");
									delayms(10);

									
									for(i=0;i<5;i++){
													debug("*************index:%d***************\n",i);
													//debug_Pic(char_img[i]);
													LCD_DrawPic(30*i,temp1->height,char_img[i]);
									}
									*/
									
									
								//	DMA_Trans((u32)char_img[3]->imageData,28*28*4, DMA_TO_DEVICE);
									
				/*					for(i=0;i<28;i++){
										for(j=0;j<28;j++){
											u32* p = (u32*)(char_img[0]->imageData);
											debug("%d,",*(p+i*28+j));
											delayms(10);
										}
										debug("\n");
									}
					*/	

								/*	for(i=0;i<5;i++){
										carID[i] = (u8)get_result(char_img[i]);
										debug("%d\n",carID[i]);
									}
									recognise=0;
									for(j=0;j<5;j++){
										u8 s  = (u8)carID[i];
										//debug("%d\n",s);
											if(carID[0]||carID[1]||carID[2]||carID[3]||carID[4]){
												carIDSTR[j] = carID[j]+'0';
											}
									}
									LCD_DrawString(0,170,"the result is:",20,WHITE,BLACK);
									LCD_DrawString(0,200,carIDSTR,24,WHITE,BLACK);
									*/
		
								/*	for(i=0;i<5;i++){
										ACC_RST_LOW;
										delayms(10);
										ACC_RST_HIGH;
										ACC_ENABLE_HIGH;
										ACC_CLEAR_HIGH;
										delayms(5);
										DMA_Trans((u32)char_img[i]->imageData,28*28*4, DMA_TO_DEVICE);
										while(0==ready);
										ACC_CLEAR_LOW;
										ACC_ENABLE_LOW;
										delayms(5);
										ready = 0;
										carID[i] = num;
										//debug("%d\n",i);
									}
									
									recognise=0;
									for(j=0;j<5;j++){
											if(carID[0]||carID[1]||carID[2]||carID[3]||carID[4]){
												carIDSTR[j] = carID[j]+'0';
											}
									}
									LCD_DrawString(0,200,carIDSTR,20,WHITE,BLACK);
									
									print("the result is : ");
									for(j=0;j<5;j++){
											if(carID[0]||carID[1]||carID[2]||carID[3]||carID[4]){
												debug("%d ",carID[j]);
											}
									}
									print("\n");
									*/
									
				/*					DMA_Trans((u32)img_test4,28*28*4, DMA_TO_DEVICE);
									while(1==ready){
										//delayms(10);//TODO:改成DMA状态查询函数
										carID[i] = num;
										ready=0;
										i++;
										if(i==5) recognise=0;
									}
									
									if(0==recognise){
										for(j=0;j<5;j++){
											if(carID[0]||carID[1]||carID[2]||carID[3]||carID[4]){
												debug("%d\n",carID[j]);
												}
											}
										}
									
										*/
									}

			}//end of condition2


								free(src);
								free(plate_img);
								free(temp1);
								free(temp2);
								free(temp3);
			
								free(src->imageData);
								free(plate_img->imageData);
								free(temp1->imageData);
								free(temp2->imageData);
								free(temp2->imageData);	
								for (int i = 0;i <5;i++){
										free(char_img[i]);
										free(char_img[i]->imageData);
			}
	}

    return 0;
} //end of main

void GPIO0_Handler( void )
{
	delayms(10);
	XGpio_InterruptClear(&BTN, 0x01);
	SNVIC_ClearPendingIRQ(0);
	u32 status = XGpio_DiscreteRead(&BTN,1);
	if(status&regmask){
		recognise += 1;
		if(recognise>=3) recognise=0;
		//TODO:加入led的控制
		print("start recognise\n");
		//delayms(10);
	}
	
	else if(status&upmask){y_pre = y;y+=step;debug("y:%d\n",y);clear  =1;}
	else if(status&downmask){hight_pre = hight;hight+=step;debug("hight:%d\n",hight);clear  =1;}
	else if(status&leftmask){x_pre = x;x+=step;debug("x:%d\n",x);clear  =1;}
	else if(status&rightmask){width_pre = width;width+=step;debug("width:%d\n",width);clear  =1;}
	
	
	/*else if(status&upmask){hight_pre = hight;hight+=step;debug("hight:%d\n",hight);clear  =1;}
	else if(status&downmask){y_pre = y;y+=step;debug("y:%d\n",y);clear  =1;}
	else if(status&leftmask){width_pre = width;width+=step;debug("width:%d\n",width);clear  =1;}
	else if(status&rightmask){x_pre = x;x+=step;debug("x:%d\n",x);clear  =1;}*/

}
